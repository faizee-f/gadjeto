sudo apt-get update
sudo apt-get upgrade -y


sudo apt-get python3-venv

python3 -m venv env

source venv/bin/activate

pip3 install -r requirements.txt


CREATE USER faizeekhan WITH PASSWORD 'faizeekhan007';
ALTER ROLE faizeekhan SET client_encoding TO 'utf8';
ALTER ROLE faizeekhan SET default_transaction_isolation TO 'read committed';
ALTER ROLE faizeekhan SET timezone TO 'UTC';
GRANT ALL PRIVILEGES ON DATABASE gadgeto TO faizeekhan;


#certificate

sudo certbot --nginx -d gadgeto.store -d www.gadgeto.store


psql gadgeto -c "GRANT ALL ON ALL TABLES IN SCHEMA public to faizeekhan;"
psql gadgeto -c "GRANT ALL ON ALL SEQUENCES IN SCHEMA public to faizeekhan;"
psql gadgeto -c "GRANT ALL ON ALL FUNCTIONS IN SCHEMA public to faizeekhan;"

sudo apt-get install -y supervisor

cd /etc/supervisor/conf.d/

[program:gunicorn]
directory=home/ubuntu/gadjeto
command=/home/ubuntu/env/bin/gunicorn --workers 3 --bind unix:/home/ubuntu/gadjeto/app.sock myproject.wsgi:application
autostart=true
autorestart=true
stderr_logfile=/var/log/gunicorn/gunocorn.err.log
stdout_logfile=/var/log/gunicorn/gunicorn.out.log
[group:guni]
programs:gunicorn



[Unit]
Description=gunicorn daemon
Requires=gunicorn.socket
After=network.target

[Service]
User=sammy
Group=www-data
WorkingDirectory=/home/sammy/myprojectdir/gadgeto
ExecStart=/home/sammy/myprojectdir/myprojectenv/bin/gunicorn \
          --access-logfile - \
          --workers 3 \
          --bind unix:/run/gunicorn.sock \
          myproject.wsgi:application

[Install]
WantedBy=multi-user.target
